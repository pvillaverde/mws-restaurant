"use strict";var map,restaurant=void 0;function sendNewReview(e,n){DBHelper.addNewReview(e).then(function(e){var t=document.getElementById("review-pending");t&&n.removeChild(t),n.appendChild(createReviewHTML(e)),showSnackbar("Review added succesfully!")}).catch(function(){showSnackbar("Review couldn't be added. Retrying..."),setTimeout(function(){return sendNewReview(e,n)},3e3)})}function toggleFavorite(){var e=document.getElementById("favorite-toggle");"false"==self.restaurant.is_favorite?(e.innerHTML='<span title="Remove from favorite restaurants" style="color:yellow;font-size:30px;">⭐</span>',self.restaurant.is_favorite="true"):(e.innerHTML='<span title="Add to favorite restaurants" style="font-size:40px;">☆</span>',self.restaurant.is_favorite="false"),updateFavoriteRestaurant(self.restaurant)}function updateFavoriteRestaurant(e){DBHelper.toggleFavoriteRestaurant(e).then(function(e){showSnackbar("Restaurant "+("true"==(self.restaurant=e).is_favorite?"marked":"unmarked")+" as favorite")}).catch(function(){showSnackbar("Changes couldn't be saved. Retrying..."),setTimeout(function(){return updateFavoriteRestaurant(e)},3e3)})}function showSnackbar(e){var t=document.getElementById("snackbar");t.className="show",t.innerHTML=e,setTimeout(function(){t.className=t.className.replace("show","")},3e3)}function fetchRestaurantFromURL(){var e=getParameterByName("id");return new Promise(function(t,n){self.restaurant?t(self.restaurant):e?DBHelper.fetchRestaurantById(e).then(function(e){self.restaurant=e,fillRestaurantHTML(),t(e)}).catch(function(e){return n(e)}):n("No restaurant id in URL")})}function fillRestaurantHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=void 0;t="true"==self.restaurant.is_favorite?'<button id="favorite-toggle" onclick="toggleFavorite()" aria-label="Favorite?"><span title="Remove from favorite restaurants" style="color:yellow;font-size:30px;">⭐</span></button>':'<button id="favorite-toggle" onclick="toggleFavorite()" aria-label="Favorite?"><span title="Add to favorite restaurants" style="font-size:40px;">☆</span></button>';var n=document.getElementById("restaurant-name");if(""==n.innerHTML){n.innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var a=DBHelper.imageUrlForRestaurant(e).replace(/\.[^/.]+$/,""),r="jpg";document.getElementById("img-container").innerHTML=t+'<picture>\n\t\t\t<source class="lazy"  media="(max-width: 600px)"  data-srcset="'+a+"-400."+r+" 400w, "+a+"-800."+r+' 800w"\n\t\t\t\t\tsizes="100vw"></source>\n\t\t\t<source class="lazy"  media="(min-width: 600px)"  data-srcset="'+a+"-400."+r+" 400w, "+a+"-800."+r+' 800w"\n\t\t\t\t\tsizes="50vw"></source>\n\t\t\t<img class="lazy" src="placeholder-image.jpg" data-src="'+a+"-800."+r+'" alt="'+e.name+"'s restaurant photo\">\n\t\t</picture>",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(e)}}function fillRestaurantHoursHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var a=document.createElement("tr");a.innerHTML='<th scope="row">'+n+"</th><td>"+e[n].replace(/,/g,"<br>")+"</td>",t.appendChild(a)}}function fillReviewsHTML(e){DBHelper.fetchReviews(e.id).then(function(e){var t=document.getElementById("reviews-list");if(!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}e.forEach(function(e){t.appendChild(createReviewHTML(e))})}),enableLazyLoading()}function createReviewHTML(e){var t=document.createElement("article");return e.date=e.updatedAt?new Date(e.updatedAt).toLocaleString("es-es",{day:"2-digit",year:"2-digit",month:"2-digit"}):"Now",t.id="review-"+e.id,t.innerHTML="\n\t\t<author>"+e.name+'</author>\n\t\t<time datetime="'+e.date+'">'+e.date+'</time>\n\t\t<meter class="meter-5-hearth" max="5" value="'+e.rating+'"></meter>\n\t\t<span role="presentation" aria-label="Rating '+e.rating+' out of 5" data-value="'+e.rating+'"></span>\n\t\t<p>'+e.comments+"</p>",t}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[[]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function enableLazyLoading(){var e=[].slice.call(document.querySelectorAll(".lazy"));if("IntersectionObserver"in window){var n=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),n.unobserve(t)}})});e.forEach(function(e){return n.observe(e)})}}document.addEventListener("DOMContentLoaded",function(){fetchRestaurantFromURL();var e=document.getElementById("writeReview"),t=document.getElementById("cancel"),n=document.getElementById("addReviewDialog");e.addEventListener("click",function(){return n.showModal()}),t.addEventListener("click",function(){return n.close()}),n.addEventListener("close",function(){var e={restaurant_id:self.restaurant.id,name:document.getElementById("userName").value,rating:parseInt(document.getElementById("rating").value),comments:document.getElementById("comments").value};if(e.name&&e.rating&&e.comments){var t=document.getElementById("reviews-list");e.id="pending",e.createdAt=(new Date).toISOString(),t.appendChild(createReviewHTML(e))}})}),window.initMap=function(){fetchRestaurantFromURL().then(function(e){self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),google.maps.event.addListener(self.map,"tilesloaded",function(e){[].slice.call(document.querySelectorAll("img:not([alt])")).forEach(function(e){e.alt||(e.alt="")})})}).catch(function(e){return console.error(e)})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJtYXAiLCJyZXN0YXVyYW50IiwicmV2aWV3IiwiY29udGFpbmVyIiwiYXBwZW5kQ2hpbGQiLCJ0aGVuIiwic2F2ZWRSZXZpZXciLCJwZW5kaW5nUmV2aWV3IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInJlbW92ZUNoaWxkIiwiY3JlYXRlUmV2aWV3SFRNTCIsInNob3dTbmFja2JhciIsImNhdGNoIiwic2V0VGltZW91dCIsInRvZ2dsZUJ1dHRvbiIsInNlbmROZXdSZXZpZXciLCJzZWxmIiwiaXNfZmF2b3JpdGUiLCJpbm5lckhUTUwiLCJ0b2dnbGVGYXZvcml0ZSIsInNhdmVkUmVzdGF1cmFudCIsInVwZGF0ZUZhdm9yaXRlUmVzdGF1cmFudCIsIkRCSGVscGVyIiwidGV4dCIsIngiLCJjbGFzc05hbWUiLCJyZXBsYWNlIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImlkIiwiY29uc29sZSIsInJlamVjdCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiZXJyb3IiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJuYW1lIiwiYWRkcmVzcyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImltYWdlRmlsZUV4dGVuc2lvbiIsImltYWdlRmlsZU5hbWUiLCJpbWFnZUNvbnRhaW5lciIsImN1aXNpbmUiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJldmlld3NIVE1MIiwia2V5Iiwicm93IiwiY3JlYXRlRWxlbWVudCIsInRhYmxlIiwicmV2aWV3cyIsIm5vUmV2aWV3cyIsImZldGNoUmV2aWV3cyIsImVuYWJsZUxhenlMb2FkaW5nIiwiYXJ0aWNsZSIsImRhdGUiLCJ1cGRhdGVkQXQiLCJEYXRlIiwidG9Mb2NhbGVTdHJpbmciLCJ5ZWFyIiwibW9udGgiLCJvcHRpb25zIiwicmF0aW5nIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVzdWx0cyIsInJlZ2V4IiwibGF6eUltYWdlcyIsImNhbGwiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGF6eUltYWdlT2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25PYnNlcnZlciIsImVudHJpZXMiLCJvYnNlcnZlciIsImZvckVhY2giLCJlbnRyeSIsImlzSW50ZXJzZWN0aW5nIiwibGF6eUltYWdlIiwidGFyZ2V0Iiwic3JjIiwiZGF0YXNldCIsInNyY3NldCIsImNsYXNzTGlzdCIsIm9ic2VydmUiLCJhZGRFdmVudExpc3RlbmVyIiwid3JpdGVCdXR0b24iLCJhZGRSZXZpZXdEaWFsb2ciLCJzaG93TW9kYWwiLCJjYW5jZWxCdXR0b24iLCJjbG9zZSIsInZhbHVlIiwicGFyc2VJbnQiLCJjb21tZW50cyIsInJlc3RhdXJhbnRfaWQiLCJjcmVhdGVkQXQiLCJ0b0lTT1N0cmluZyIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0bG5nIiwic2Nyb2xsd2hlZWwiLCJldmVudCIsImFkZExpc3RlbmVyIiwiZXZ0IiwiaW1nIiwiYWx0Il0sIm1hcHBpbmdzIjoiYUFBQSxJQUNJQSxJQURBQyxnQkFBQUEsRUE4QkRDLFNBQUFBLGNBQW1CQSxFQUFBQyxHQUNuQkEsU0FBQUEsYUFBVUMsR0FDVkMsS0FBQSxTQUFBQyxHQWRGLElBQUFDLEVBQUFDLFNBQUFDLGVBQUEsa0JBWkRGLEdBQUFKLEVBQUFPLFlBQUFILEdBbUNHSixFQUFVQyxZQUFZTyxpQkFBaUJMLElBTDFDTSxhQUFBQSwrQkFHR0MsTUFBTU4sV0FDTkssYUFBQUEseUNBQ0FULFdBQVVDLFdBQUFBLE9BQUFBLGNBQVlPLEVBQWlCTCxJQUF2QyxPQUtBUSxTQUFBQSxpQkFBVyxJQUFBQyxFQUFNQyxTQUFBUCxlQUFBTyxtQkFBa0MsU0FBQUMsS0FBbkRoQixXQUFBaUIsYUFURkgsRUFBQUksVUFBQSwrRkFXQUYs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LEVBQUFDLE1BQUFELEVBQUFDLElBQUEsVUFPQVgsTUFBT0MsU0FBQUEsR0FBQUEsT0FBV08sUUFBQUEsTUFBWTlGIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xyXG52YXIgbWFwO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihgRE9NQ29udGVudExvYWRlZGAsICggLypldmVudCovICkgPT4ge1xyXG5cdGZldGNoUmVzdGF1cmFudEZyb21VUkwoKTtcclxuXHR2YXIgd3JpdGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgd3JpdGVSZXZpZXdgKTtcclxuXHR2YXIgY2FuY2VsQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGNhbmNlbGApO1xyXG5cdHZhciBhZGRSZXZpZXdEaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYWRkUmV2aWV3RGlhbG9nYCk7XHJcblxyXG5cdC8vIFVwZGF0ZSBidXR0b24gb3BlbnMgYSBtb2RhbCBkaWFsb2dcclxuXHR3cml0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsICgpID0+IGFkZFJldmlld0RpYWxvZy5zaG93TW9kYWwoKSk7XHJcblxyXG5cdC8vIEZvcm0gY2FuY2VsIGJ1dHRvbiBjbG9zZXMgdGhlIGRpYWxvZyBib3hcclxuXHRjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBhZGRSZXZpZXdEaWFsb2cuY2xvc2UoKSk7XHJcblx0Ly8gRm9ybSBjYW5jZWwgYnV0dG9uIGNsb3NlcyB0aGUgZGlhbG9nIGJveFxyXG5cdGFkZFJldmlld0RpYWxvZy5hZGRFdmVudExpc3RlbmVyKGBjbG9zZWAsIGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJldmlldyA9IHtcclxuXHRcdFx0cmVzdGF1cmFudF9pZDogc2VsZi5yZXN0YXVyYW50LmlkLFxyXG5cdFx0XHRuYW1lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdXNlck5hbWVgKS52YWx1ZSxcclxuXHRcdFx0cmF0aW5nOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcmF0aW5nYCkudmFsdWUpLFxyXG5cdFx0XHRjb21tZW50czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGNvbW1lbnRzYCkudmFsdWUsXHJcblx0XHR9O1xyXG5cdFx0aWYgKHJldmlldy5uYW1lICYmIHJldmlldy5yYXRpbmcgJiYgcmV2aWV3LmNvbW1lbnRzKSB7XHJcblx0XHRcdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXZpZXdzLWxpc3RgKTtcclxuXHRcdFx0Ly9zZW5kTmV3UmV2aWV3KHJldmlldywgY29udGFpbmVyKTtcclxuXHJcblx0XHRcdHJldmlldy5pZCA9IGBwZW5kaW5nYDtcclxuXHRcdFx0cmV2aWV3LmNyZWF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuXHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gc2VuZE5ld1JldmlldyhyZXZpZXcsIGNvbnRhaW5lcikge1xyXG5cdERCSGVscGVyLmFkZE5ld1JldmlldyhyZXZpZXcpXHJcblx0XHQudGhlbigoc2F2ZWRSZXZpZXcpID0+IHtcclxuXHRcdFx0Y29uc3QgcGVuZGluZ1JldmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXZpZXctcGVuZGluZ2ApO1xyXG5cdFx0XHRpZiAocGVuZGluZ1JldmlldykgY29udGFpbmVyLnJlbW92ZUNoaWxkKHBlbmRpbmdSZXZpZXcpO1xyXG5cdFx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChzYXZlZFJldmlldykpO1xyXG5cdFx0XHRzaG93U25hY2tiYXIoYFJldmlldyBhZGRlZCBzdWNjZXNmdWxseSFgKTtcclxuXHRcdH0pXHJcblx0XHQuY2F0Y2goKCkgPT4ge1xyXG5cdFx0XHRzaG93U25hY2tiYXIoYFJldmlldyBjb3VsZG4ndCBiZSBhZGRlZC4gUmV0cnlpbmcuLi5gKTtcclxuXHRcdFx0c2V0VGltZW91dCgoKSA9PiBzZW5kTmV3UmV2aWV3KHJldmlldywgY29udGFpbmVyKSwgMzAwMCk7XHJcblx0XHR9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlRmF2b3JpdGUoKSB7XHJcblx0Y29uc3QgdG9nZ2xlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGZhdm9yaXRlLXRvZ2dsZWApO1xyXG5cdGlmIChzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT0gYGZhbHNlYCkge1xyXG5cdFx0dG9nZ2xlQnV0dG9uLmlubmVySFRNTCA9IGA8c3BhbiB0aXRsZT1cIlJlbW92ZSBmcm9tIGZhdm9yaXRlIHJlc3RhdXJhbnRzXCIgc3R5bGU9XCJjb2xvcjp5ZWxsb3c7Zm9udC1zaXplOjMwcHg7XCI+4q2QPC9zcGFuPmA7XHJcblx0XHRzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBgdHJ1ZWA7XHJcblx0fSBlbHNlIHtcclxuXHRcdHRvZ2dsZUJ1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gdGl0bGU9XCJBZGQgdG8gZmF2b3JpdGUgcmVzdGF1cmFudHNcIiBzdHlsZT1cImZvbnQtc2l6ZTo0MHB4O1wiPuKYhjwvc3Bhbj5gO1xyXG5cdFx0c2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gYGZhbHNlYDtcclxuXHR9XHJcblx0dXBkYXRlRmF2b3JpdGVSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUZhdm9yaXRlUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcblx0REJIZWxwZXIudG9nZ2xlRmF2b3JpdGVSZXN0YXVyYW50KHJlc3RhdXJhbnQpXHJcblx0XHQudGhlbigoc2F2ZWRSZXN0YXVyYW50KSA9PiB7XHJcblx0XHRcdHNlbGYucmVzdGF1cmFudCA9IHNhdmVkUmVzdGF1cmFudDtcclxuXHRcdFx0c2hvd1NuYWNrYmFyKGBSZXN0YXVyYW50ICR7c2F2ZWRSZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09YHRydWVgID8gYG1hcmtlZGAgOiBgdW5tYXJrZWRgfSBhcyBmYXZvcml0ZWApO1xyXG5cdFx0fSlcclxuXHRcdC5jYXRjaCgoKSA9PiB7XHJcblx0XHRcdHNob3dTbmFja2JhcihgQ2hhbmdlcyBjb3VsZG4ndCBiZSBzYXZlZC4gUmV0cnlpbmcuLi5gKTtcclxuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB1cGRhdGVGYXZvcml0ZVJlc3RhdXJhbnQocmVzdGF1cmFudCksIDMwMDApO1xyXG5cdFx0fSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dTbmFja2Jhcih0ZXh0KSB7XHJcblx0Ly8gR2V0IHRoZSBzbmFja2JhciBESVZcclxuXHR2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzbmFja2JhcmApO1xyXG5cclxuXHQvLyBBZGQgdGhlIFwic2hvd1wiIGNsYXNzIHRvIERJVlxyXG5cdHguY2xhc3NOYW1lID0gYHNob3dgO1xyXG5cdHguaW5uZXJIVE1MID0gdGV4dDtcclxuXHJcblx0Ly8gQWZ0ZXIgMyBzZWNvbmRzLCByZW1vdmUgdGhlIHNob3cgY2xhc3MgZnJvbSBESVZcclxuXHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG5cdFx0eC5jbGFzc05hbWUgPSB4LmNsYXNzTmFtZS5yZXBsYWNlKGBzaG93YCwgYGApO1xyXG5cdH0sIDMwMDApO1xyXG59XHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuXHRmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKCkudGhlbigocmVzdGF1cmFudCkgPT4ge1xyXG5cdFx0c2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBtYXBgKSwge1xyXG5cdFx0XHR6b29tOiAxNixcclxuXHRcdFx0Y2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcclxuXHRcdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXHJcblx0XHR9KTtcclxuXHRcdERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcblx0XHQvKiBTZXQgYWx0IGF0dHJpYnV0ZXMgb24gbWFwcyBpbWFnZXMgc28gdGhleSBkb250IGdldCByZWFkZWQgYnkgc2NyZWVuUmVhZGVycyAqL1xyXG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoc2VsZi5tYXAsIGB0aWxlc2xvYWRlZGAsIGZ1bmN0aW9uKGV2dCkge1xyXG5cdFx0XHR2YXIgbm9BbHRJbWFnZXMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGltZzpub3QoW2FsdF0pYCkpO1xyXG5cdFx0XHRub0FsdEltYWdlcy5mb3JFYWNoKGltZyA9PiB7XHJcblx0XHRcdFx0aWYgKCFpbWcuYWx0KSBpbWcuYWx0ID0gYGA7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSk7XHJcblx0fSkuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbn07XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpIHtcclxuXHRjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZShgaWRgKTtcclxuXHRjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0aWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuXHRcdFx0cmVzb2x2ZShzZWxmLnJlc3RhdXJhbnQpO1xyXG5cdFx0fSBlbHNlIGlmICghaWQpIHtcclxuXHRcdFx0cmVqZWN0KGBObyByZXN0YXVyYW50IGlkIGluIFVSTGApO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkudGhlbigocmVzdGF1cmFudCkgPT4ge1xyXG5cdFx0XHRcdHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcblx0XHRcdFx0ZmlsbFJlc3RhdXJhbnRIVE1MKCk7XHJcblx0XHRcdFx0cmVzb2x2ZShyZXN0YXVyYW50KTtcclxuXHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHRyZXR1cm4gcHJvbWlzZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpIHtcclxuXHRsZXQgdG9nZ2xlQnV0dG9uO1xyXG5cdGlmIChzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT0gYHRydWVgKSB7XHJcblx0XHR0b2dnbGVCdXR0b24gPSBgPGJ1dHRvbiBpZD1cImZhdm9yaXRlLXRvZ2dsZVwiIG9uY2xpY2s9XCJ0b2dnbGVGYXZvcml0ZSgpXCIgYXJpYS1sYWJlbD1cIkZhdm9yaXRlP1wiPjxzcGFuIHRpdGxlPVwiUmVtb3ZlIGZyb20gZmF2b3JpdGUgcmVzdGF1cmFudHNcIiBzdHlsZT1cImNvbG9yOnllbGxvdztmb250LXNpemU6MzBweDtcIj7irZA8L3NwYW4+PC9idXR0b24+YDtcclxuXHR9IGVsc2Uge1xyXG5cdFx0dG9nZ2xlQnV0dG9uID0gYDxidXR0b24gaWQ9XCJmYXZvcml0ZS10b2dnbGVcIiBvbmNsaWNrPVwidG9nZ2xlRmF2b3JpdGUoKVwiIGFyaWEtbGFiZWw9XCJGYXZvcml0ZT9cIj48c3BhbiB0aXRsZT1cIkFkZCB0byBmYXZvcml0ZSByZXN0YXVyYW50c1wiIHN0eWxlPVwiZm9udC1zaXplOjQwcHg7XCI+4piGPC9zcGFuPjwvYnV0dG9uPmA7XHJcblx0fVxyXG5cclxuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJlc3RhdXJhbnQtbmFtZWApO1xyXG5cdGlmIChuYW1lLmlubmVySFRNTCAhPSBgYCkgcmV0dXJuO1xyXG5cdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cclxuXHRjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJlc3RhdXJhbnQtYWRkcmVzc2ApO1xyXG5cdGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuXHRjb25zdCBpbWFnZUZpbGVOYW1lID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLnJlcGxhY2UoL1xcLlteLy5dKyQvLCBgYCk7XHJcblx0Lypjb25zdCBpbWFnZUZpbGVFeHRlbnNpb24gPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkuc3BsaXQoYC5gKS5wb3AoKTsqL1xyXG5cdGNvbnN0IGltYWdlRmlsZUV4dGVuc2lvbiA9IGBqcGdgO1xyXG5cdGNvbnN0IGltYWdlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGltZy1jb250YWluZXJgKTtcclxuXHRpbWFnZUNvbnRhaW5lci5pbm5lckhUTUwgPSBgJHt0b2dnbGVCdXR0b259PHBpY3R1cmU+XHJcblx0XHRcdDxzb3VyY2UgY2xhc3M9XCJsYXp5XCIgIG1lZGlhPVwiKG1heC13aWR0aDogNjAwcHgpXCIgIGRhdGEtc3Jjc2V0PVwiJHtpbWFnZUZpbGVOYW1lfS00MDAuJHtpbWFnZUZpbGVFeHRlbnNpb259IDQwMHcsICR7aW1hZ2VGaWxlTmFtZX0tODAwLiR7aW1hZ2VGaWxlRXh0ZW5zaW9ufSA4MDB3XCJcclxuXHRcdFx0XHRcdHNpemVzPVwiMTAwdndcIj48L3NvdXJjZT5cclxuXHRcdFx0PHNvdXJjZSBjbGFzcz1cImxhenlcIiAgbWVkaWE9XCIobWluLXdpZHRoOiA2MDBweClcIiAgZGF0YS1zcmNzZXQ9XCIke2ltYWdlRmlsZU5hbWV9LTQwMC4ke2ltYWdlRmlsZUV4dGVuc2lvbn0gNDAwdywgJHtpbWFnZUZpbGVOYW1lfS04MDAuJHtpbWFnZUZpbGVFeHRlbnNpb259IDgwMHdcIlxyXG5cdFx0XHRcdFx0c2l6ZXM9XCI1MHZ3XCI+PC9zb3VyY2U+XHJcblx0XHRcdDxpbWcgY2xhc3M9XCJsYXp5XCIgc3JjPVwicGxhY2Vob2xkZXItaW1hZ2UuanBnXCIgZGF0YS1zcmM9XCIke2ltYWdlRmlsZU5hbWV9LTgwMC4ke2ltYWdlRmlsZUV4dGVuc2lvbn1cIiBhbHQ9XCIke3Jlc3RhdXJhbnQubmFtZX0ncyByZXN0YXVyYW50IHBob3RvXCI+XHJcblx0XHQ8L3BpY3R1cmU+YDtcclxuXHJcblx0Y29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXN0YXVyYW50LWN1aXNpbmVgKTtcclxuXHRjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuXHQvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xyXG5cdGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG5cdFx0ZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuXHR9XHJcblx0Ly8gZmlsbCByZXZpZXdzXHJcblx0ZmlsbFJldmlld3NIVE1MKHJlc3RhdXJhbnQpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG5cdGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJlc3RhdXJhbnQtaG91cnNgKTtcclxuXHRmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcclxuXHRcdGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYHRyYCk7XHJcblx0XHRyb3cuaW5uZXJIVE1MID0gYDx0aCBzY29wZT1cInJvd1wiPiR7a2V5fTwvdGg+PHRkPiR7b3BlcmF0aW5nSG91cnNba2V5XS5yZXBsYWNlKC8sL2csYDxicj5gKX08L3RkPmA7XHJcblx0XHR0YWJsZS5hcHBlbmRDaGlsZChyb3cpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxSZXZpZXdzSFRNTChyZXN0YXVyYW50KSB7XHJcblx0REJIZWxwZXIuZmV0Y2hSZXZpZXdzKHJlc3RhdXJhbnQuaWQpLnRoZW4ocmV2aWV3cyA9PiB7XHJcblx0XHRjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcmV2aWV3cy1saXN0YCk7XHJcblx0XHRpZiAoIXJldmlld3MpIHtcclxuXHRcdFx0Y29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgcGApO1xyXG5cdFx0XHRub1Jldmlld3MuaW5uZXJIVE1MID0gYE5vIHJldmlld3MgeWV0IWA7XHJcblx0XHRcdGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRyZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuXHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHRlbmFibGVMYXp5TG9hZGluZygpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVSZXZpZXdIVE1MKHJldmlldykge1xyXG5cdGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBhcnRpY2xlYCk7XHJcblx0Y29uc3Qgb3B0aW9ucyA9IHtcclxuXHRcdGRheTogYDItZGlnaXRgLFxyXG5cdFx0Ly93ZWVrZGF5OiBgbG9uZ2AsXHJcblx0XHR5ZWFyOiBgMi1kaWdpdGAsXHJcblx0XHRtb250aDogYDItZGlnaXRgLFxyXG5cdH07XHJcblx0cmV2aWV3LmRhdGUgPSByZXZpZXcudXBkYXRlZEF0ID8gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCkudG9Mb2NhbGVTdHJpbmcoYGVzLWVzYCwgb3B0aW9ucykgOiBgTm93YDtcclxuXHRhcnRpY2xlLmlkID0gYHJldmlldy0ke3Jldmlldy5pZH1gO1xyXG5cdGFydGljbGUuaW5uZXJIVE1MID0gYFxyXG5cdFx0PGF1dGhvcj4ke3Jldmlldy5uYW1lfTwvYXV0aG9yPlxyXG5cdFx0PHRpbWUgZGF0ZXRpbWU9XCIke3Jldmlldy5kYXRlfVwiPiR7cmV2aWV3LmRhdGV9PC90aW1lPlxyXG5cdFx0PG1ldGVyIGNsYXNzPVwibWV0ZXItNS1oZWFydGhcIiBtYXg9XCI1XCIgdmFsdWU9XCIke3Jldmlldy5yYXRpbmd9XCI+PC9tZXRlcj5cclxuXHRcdDxzcGFuIHJvbGU9XCJwcmVzZW50YXRpb25cIiBhcmlhLWxhYmVsPVwiUmF0aW5nICR7cmV2aWV3LnJhdGluZ30gb3V0IG9mIDVcIiBkYXRhLXZhbHVlPVwiJHtyZXZpZXcucmF0aW5nfVwiPjwvc3Bhbj5cclxuXHRcdDxwPiR7cmV2aWV3LmNvbW1lbnRzfTwvcD5gO1xyXG5cdHJldHVybiBhcnRpY2xlO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbi8qZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG5cdGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblx0YnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XHJcbn0qL1xyXG5cclxuLyoqXHJcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKSB7XHJcblx0aWYgKCF1cmwpXHJcblx0XHR1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuXHRuYW1lID0gbmFtZS5yZXBsYWNlKC9bW11dL2csIGBcXFxcJCZgKTtcclxuXHRjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuXHRcdHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcblx0aWYgKCFyZXN1bHRzKVxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0aWYgKCFyZXN1bHRzWzJdKVxyXG5cdFx0cmV0dXJuIGBgO1xyXG5cdHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgYCBgKSk7XHJcbn1cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5mdW5jdGlvbiBlbmFibGVMYXp5TG9hZGluZygpIHtcclxuXHR2YXIgbGF6eUltYWdlcyA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLmxhenlgKSk7XHJcblx0aWYgKGBJbnRlcnNlY3Rpb25PYnNlcnZlcmAgaW4gd2luZG93KSB7XHJcblx0XHRsZXQgbGF6eUltYWdlT2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMsIG9ic2VydmVyKSA9PiB7XHJcblx0XHRcdGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XHJcblx0XHRcdFx0aWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XHJcblx0XHRcdFx0XHRsZXQgbGF6eUltYWdlID0gZW50cnkudGFyZ2V0O1xyXG5cdFx0XHRcdFx0bGF6eUltYWdlLnNyYyA9IGxhenlJbWFnZS5kYXRhc2V0LnNyYztcclxuXHRcdFx0XHRcdGxhenlJbWFnZS5zcmNzZXQgPSBsYXp5SW1hZ2UuZGF0YXNldC5zcmNzZXQ7XHJcblx0XHRcdFx0XHRsYXp5SW1hZ2UuY2xhc3NMaXN0LnJlbW92ZShgbGF6eWApO1xyXG5cdFx0XHRcdFx0bGF6eUltYWdlT2JzZXJ2ZXIudW5vYnNlcnZlKGxhenlJbWFnZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cdFx0bGF6eUltYWdlcy5mb3JFYWNoKGxhenlJbWFnZSA9PiBsYXp5SW1hZ2VPYnNlcnZlci5vYnNlcnZlKGxhenlJbWFnZSkpO1xyXG5cdH0gZWxzZSB7XHJcblx0XHQvLyBQb3NzaWJseSBmYWxsIGJhY2sgdG8gYSBtb3JlIGNvbXBhdGlibGUgbWV0aG9kIGhlcmVcclxuXHR9XHJcbn0iXX0=
