"use strict";var map,restaurant=void 0;function sendNewReview(e,a){DBHelper.addNewReview(e).then(function(e){var t=document.getElementById("review-pending");t&&a.removeChild(t),a.appendChild(createReviewHTML(e)),showSnackbar("Review added succesfully!")}).catch(function(){showSnackbar("Review couldn't be added. Retrying..."),setTimeout(function(){return sendNewReview(e,a)},3e3)})}function toggleFavorite(){var e=document.getElementById("favorite-toggle");self.restaurant.is_favorite&&"false"!=self.restaurant.is_favorite?(e.innerHTML='<span title="Add to favorite restaurants" style="font-size:40px;">☆</span>',self.restaurant.is_favorite="false"):(e.innerHTML='<span title="Remove from favorite restaurants" style="color:yellow;font-size:30px;">⭐</span>',self.restaurant.is_favorite="true"),updateFavoriteRestaurant(self.restaurant)}function updateFavoriteRestaurant(e){DBHelper.toggleFavoriteRestaurant(e).then(function(e){showSnackbar("Restaurant "+("true"==(self.restaurant=e).is_favorite?"marked":"unmarked")+" as favorite")}).catch(function(){showSnackbar("Changes couldn't be saved. Retrying..."),setTimeout(function(){return updateFavoriteRestaurant(e)},3e3)})}function showSnackbar(e){var t=document.getElementById("snackbar");t.className="show",t.innerHTML=e,setTimeout(function(){t.className=t.className.replace("show","")},3e3)}function toggleMap(){if(document.getElementById("map-script"))window.initMap();else{var e=document.createElement("script");e.id="map-script",e.setAttribute("src","https://maps.googleapis.com/maps/api/js?v=3.30&key=AIzaSyBnpXTRc4VnjfrA6lesKaIJuYLsa_UcJpo&libraries=places&callback=initMap"),document.head.appendChild(e)}}function fetchRestaurantFromURL(){var e=getParameterByName("id");return new Promise(function(t,a){self.restaurant?t(self.restaurant):e?DBHelper.fetchRestaurantById(e).then(function(e){self.restaurant=e,fillRestaurantHTML(),t(e)}).catch(function(e){return a(e)}):a("No restaurant id in URL")})}function fillRestaurantHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=void 0;t="true"==self.restaurant.is_favorite?'<button id="favorite-toggle" onclick="toggleFavorite()" aria-label="Favorite?"><span title="Remove from favorite restaurants" style="color:yellow;font-size:30px;">⭐</span></button>':'<button id="favorite-toggle" onclick="toggleFavorite()" aria-label="Favorite?"><span title="Add to favorite restaurants" style="font-size:40px;">☆</span></button>';var a=document.getElementById("restaurant-name");if(""==a.innerHTML){a.innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var n=DBHelper.imageUrlForRestaurant(e).replace(/\.[^/.]+$/,"");document.getElementById("img-container").innerHTML=t+'<picture>\n\t\t\t<source class="lazy"  media="(max-width: 600px)"  data-srcset="'+n+"-400.webp 400w, "+n+'-800.webp 800w" sizes="100vw" type="image/webp"></source>\n\t\t\t<source class="lazy"  media="(min-width: 600px)"  data-srcset="'+n+"-400.webp 400w, "+n+'-800.webp 800w" sizes="50vw" type="image/webp"></source>\n\t\t\t<source class="lazy"  media="(max-width: 600px)"  data-srcset="'+n+"-400.jpg 400w, "+n+'-800.jpg 800w" sizes="100vw" type="image/jpeg"></source>\n\t\t\t<source class="lazy"  media="(min-width: 600px)"  data-srcset="'+n+"-400.jpg 400w, "+n+'-800.jpg 800w" sizes="50vw" type="image/jpeg"></source>\n\t\t\t<img class="lazy" src="assets/img/placeholder-image-800.webp" data-src="'+n+'-800.jpg" alt="'+e.name+"'s restaurant photo\">\n\t\t</picture>",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(e)}}function fillRestaurantHoursHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var a in e){var n=document.createElement("tr");n.innerHTML='<th scope="row">'+a+"</th><td>"+e[a].replace(/,/g,"<br>")+"</td>",t.appendChild(n)}}function fillReviewsHTML(e){DBHelper.fetchReviews(e.id).then(function(e){var t=document.getElementById("reviews-list");if(!e){var a=document.createElement("p");return a.innerHTML="No reviews yet!",void t.appendChild(a)}e.forEach(function(e){t.appendChild(createReviewHTML(e))})}),enableLazyLoading()}function createReviewHTML(e){var t=document.createElement("article");return e.date=e.updatedAt?new Date(e.updatedAt).toLocaleString("es-es",{day:"2-digit",year:"2-digit",month:"2-digit"}):"Now",t.id="review-"+e.id,t.innerHTML="\n\t\t<author>"+e.name+'</author>\n\t\t<time datetime="'+e.date+'">'+e.date+'</time>\n\t\t<meter class="meter-5-hearth" max="5" value="'+e.rating+'"></meter>\n\t\t<span role="presentation" aria-label="Rating '+e.rating+' out of 5" data-value="'+e.rating+'"></span>\n\t\t<p>'+e.comments+"</p>",t}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[[]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function enableLazyLoading(){var e=[].slice.call(document.querySelectorAll(".lazy"));if("IntersectionObserver"in window){var a=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.dataset.src&&(t.src=t.dataset.src),t.dataset.srcset&&(t.srcset=t.dataset.srcset),t.classList.remove("lazy"),a.unobserve(t)}})});e.forEach(function(e){return a.observe(e)})}}document.addEventListener("DOMContentLoaded",function(){fetchRestaurantFromURL();var e=document.getElementById("writeReview"),t=document.getElementById("cancel"),a=document.getElementById("addReviewDialog"),n=document.getElementById("mapDialog"),r=document.getElementById("viewMap"),i=document.getElementById("cancelMap");e.addEventListener("click",function(){return a.showModal()}),r.addEventListener("click",function(){n.showModal(),toggleMap()}),t.addEventListener("click",function(){return a.close()}),i.addEventListener("click",function(){return n.close()}),a.addEventListener("close",function(){var e={restaurant_id:self.restaurant.id,name:document.getElementById("userName").value,rating:parseInt(document.getElementById("rating").value),comments:document.getElementById("comments").value};if(e.name&&e.rating&&e.comments){var t=document.getElementById("reviews-list");sendNewReview(e,t),e.id="pending",e.createdAt=(new Date).toISOString(),t.appendChild(createReviewHTML(e))}})}),window.initMap=function(){var e=document.getElementById("map");self.map=new google.maps.Map(e,{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),google.maps.event.addListener(self.map,"tilesloaded",function(e){[].slice.call(document.querySelectorAll("img:not([alt])")).forEach(function(e){e.alt||(e.alt="")})})};