"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"openDatabase",value:function(){return navigator.serviceWorker?idb.open("review-restaurants",2,function(e){switch(e.oldVersion){case 0:var t=e.createObjectStore("restaurants",{keyPath:"id"});t.createIndex("by-cuisine","cuisine_type"),t.createIndex("by-neighborhood","neighborhood");case 1:e.createObjectStore("reviews",{keyPath:"id"}).createIndex("by-restaurant","restaurant_id")}}):Promise.resolve()}},{key:"fetchRestaurants",value:function(){return a.getRestaurantsFromLocal().then(function(e){return e&&e.length?(a.getRestaurantsFromRemote(),e):a.getRestaurantsFromRemote()})}},{key:"getRestaurantsFromLocal",value:function(){return a.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").getAll()})}},{key:"getRestaurantsFromRemote",value:function(){return fetch(a.DATABASE_URL+"/restaurants").then(function(e){return e.json()}).then(function(e){return a.addRestaurantsToIndexDB(e),e})}},{key:"toggleFavoriteRestaurant",value:function(e){return fetch(a.DATABASE_URL+"/restaurants/"+e.id+"/?is_favorite="+e.is_favorite,{method:"PUT"}).then(function(e){return e.json()}).then(function(e){return a.addRestaurantsToIndexDB([e]),e})}},{key:"addRestaurantsToIndexDB",value:function(r){return a.openDatabase().then(function(e){if(e){var t=e.transaction("restaurants","readwrite"),n=t.objectStore("restaurants");return r.forEach(function(e){return n.put(e)}),t.complete}})}},{key:"fetchReviews",value:function(t){return a.getReviewsFromLocal(t).then(function(e){return e&&e.length?(a.getReviewsFromRemote(t),e):a.getReviewsFromRemote(t)})}},{key:"getReviewsFromLocal",value:function(t){return a.openDatabase().then(function(e){if(e)return e.transaction("reviews").objectStore("reviews").index("by-restaurant").getAll(t)})}},{key:"getReviewsFromRemote",value:function(e){return fetch(a.DATABASE_URL+"/reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(function(e){return a.addReviewsToIndexDB(e),e})}},{key:"addNewReview",value:function(e){return fetch(a.DATABASE_URL+"/reviews",{method:"POST",body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return a.addReviewsToIndexDB([e]),e})}},{key:"addReviewsToIndexDB",value:function(r){return a.openDatabase().then(function(e){if(e){var t=e.transaction("reviews","readwrite"),n=t.objectStore("reviews");return r.forEach(function(e){return n.put(e)}),t.complete}})}},{key:"fetchRestaurantById",value:function(t){return a.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").get(parseInt(t))}).then(function(e){return e||fetch(a.DATABASE_URL+"/restaurants/"+t).then(function(e){return e.json()})})}},{key:"fetchRestaurantByCuisine",value:function(t){return a.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})}).catch(function(){return a.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").index("by-cuisine").getAll(t)})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return a.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})}).catch(function(){return a.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").index("by-neighborhood")})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoods",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"fetchCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].cuisine_type});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/assets/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:a.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInVwZ3JhZGVEQiIsIlByb21pc2UiLCJyZXNvbHZlIiwiaWRiIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwicmVzdGF1cmFudHNTdG9yZSIsImNyZWF0ZUluZGV4IiwiZ2V0UmVzdGF1cmFudHNGcm9tTG9jYWwiLCJ0aGVuIiwicmVzdGF1cmFudHMiLCJsZW5ndGgiLCJnZXRSZXN0YXVyYW50c0Zyb21SZW1vdGUiLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJmZXRjaCIsIm9wZW5EYXRhYmFzZSIsInJlc3BvbnNlIiwianNvbiIsImFkZFJlc3RhdXJhbnRzVG9JbmRleERCIiwicmVzdGF1cmFudCIsIkRBVEFCQVNFX1VSTCIsImlkIiwiaXNfZmF2b3JpdGUiLCJtZXRob2QiLCJzdG9yZSIsImZvckVhY2giLCJwdXQiLCJ0eCIsImNvbXBsZXRlIiwicmV2aWV3cyIsImdldFJldmlld3NGcm9tUmVtb3RlIiwiaW5kZXgiLCJhZGRSZXZpZXdzVG9JbmRleERCIiwicmV2aWV3IiwiYm9keSIsInN0cmluZ2lmeSIsImdldCIsInBhcnNlSW50IiwiY3Vpc2luZSIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJjYXRjaCIsIm5laWdoYm9yaG9vZCIsImZldGNoUmVzdGF1cmFudHMiLCJyZXN1bHRzIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwicGhvdG9ncmFwaCIsIm1hcHMiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsImFuaW1hdGlvbiIsImdvb2dsZSIsIkFuaW1hdGlvbiIsIkRST1AiXSwibWFwcGluZ3MiOiJpWUFHTUEsMEhBV0wsT0FBQUMsVUFBQUMsY0FJTUQsSUFBQUEsS0FBQUEscUJBQXlCLEVBQUEsU0FBQUUs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QyxFQUFZd0MsSUFBSSxTQUFDQyxFQUFHQyxHQUFKLE9BQVUxQyxFQUFZMEMsR0FBR1IsZUE3Q25ELE9BQUFVLEVBQUFaLE9BQUEsU0FBQVMsRUFBQUMsR0FBQSxPQUFBRSxFQUFBRCxRQUFBRixJQUFBQywrQ0F1RGU5QixHQUN2QixNQUFBLHdCQUFnQ0EsRUFBV0UsaURBMUNsQkYsR0FDdkIwQixNQUFBQSxlQUFrQk4sRUFBT2EsMERBR0FqQyxFQUFBNEIsR0FNNUIsT0FObUNKLElBQUFBLE9BQUZVLEtBQWtCVixPQUFBQSxDQUF2QlcsU0FBekJuQyxFQUFBb0MsT0FDQUMsTUFBQXJDLEVBQUFzQyxLQUNEQyxJQUFBaEUsRUFBT21ELGlCQUFQMUIsR0FDQTRCLElBVERBLEVBVUFZLFVBQUFDLE9BQUFQLEtBQUFRLFVBQUFDLDRDQXROQSxNQUFBIiwiZmlsZSI6ImRiaGVscGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cdC8qKlxyXG5cdCAqIERhdGFiYXNlIFVSTC5cclxuXHQgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcblx0ICovXHJcblx0c3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcblx0XHRjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG5cdFx0cmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gO1xyXG5cdFx0LypyZXR1cm4gYC9kYXRhL3Jlc3RhdXJhbnRzLmpzb25gOyovXHJcblx0fVxyXG5cclxuXHQvKiBPcGVuIEluZGV4REIgRGF0YWJhc2UqL1xyXG5cdHN0YXRpYyBvcGVuRGF0YWJhc2UoKSB7XHJcblx0XHQvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgc2VydmljZSB3b3JrZXIsXHJcblx0XHQvLyB3ZSBkb24ndCBjYXJlIGFib3V0IGhhdmluZyBhIGRhdGFiYXNlXHJcblx0XHRpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gaWRiLm9wZW4oYHJldmlldy1yZXN0YXVyYW50c2AsIDIsICh1cGdyYWRlREIpID0+IHtcclxuXHRcdFx0c3dpdGNoICh1cGdyYWRlREIub2xkVmVyc2lvbikge1xyXG5cdFx0XHRcdGNhc2UgMDpcclxuXHRcdFx0XHRcdHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgcmVzdGF1cmFudHNTdG9yZSA9IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShgcmVzdGF1cmFudHNgLCB7XHJcblx0XHRcdFx0XHRcdFx0a2V5UGF0aDogYGlkYFxyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0cmVzdGF1cmFudHNTdG9yZS5jcmVhdGVJbmRleChgYnktY3Vpc2luZWAsIGBjdWlzaW5lX3R5cGVgKTtcclxuXHRcdFx0XHRcdFx0cmVzdGF1cmFudHNTdG9yZS5jcmVhdGVJbmRleChgYnktbmVpZ2hib3Job29kYCwgYG5laWdoYm9yaG9vZGApO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Ly8gYnJlYWsgb21pdHRlZFxyXG5cdFx0XHRcdGNhc2UgMTpcclxuXHRcdFx0XHRcdHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgcmV2aWV3c1N0b3JlID0gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKGByZXZpZXdzYCwge1xyXG5cdFx0XHRcdFx0XHRcdGtleVBhdGg6IGBpZGBcclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdHJldmlld3NTdG9yZS5jcmVhdGVJbmRleChgYnktcmVzdGF1cmFudGAsIGByZXN0YXVyYW50X2lkYCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cygpIHtcclxuXHRcdHJldHVybiBEQkhlbHBlci5nZXRSZXN0YXVyYW50c0Zyb21Mb2NhbCgpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG5cdFx0XHRpZiAocmVzdGF1cmFudHMgJiYgcmVzdGF1cmFudHMubGVuZ3RoKSB7XHJcblx0XHRcdFx0REJIZWxwZXIuZ2V0UmVzdGF1cmFudHNGcm9tUmVtb3RlKCk7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3RhdXJhbnRzO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiBEQkhlbHBlci5nZXRSZXN0YXVyYW50c0Zyb21SZW1vdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0UmVzdGF1cmFudHNGcm9tTG9jYWwoKSB7XHJcblx0XHRyZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbigoZGIpID0+IHtcclxuXHRcdFx0aWYgKCFkYikgcmV0dXJuO1xyXG5cdFx0XHRyZXR1cm4gZGIudHJhbnNhY3Rpb24oYHJlc3RhdXJhbnRzYCkub2JqZWN0U3RvcmUoYHJlc3RhdXJhbnRzYCkuZ2V0QWxsKCk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50c0Zyb21SZW1vdGUoKSB7XHJcblx0XHRyZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50c2ApXHJcblx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuXHRcdFx0LnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG5cdFx0XHRcdERCSGVscGVyLmFkZFJlc3RhdXJhbnRzVG9JbmRleERCKHJlc3RhdXJhbnRzKTtcclxuXHRcdFx0XHRyZXR1cm4gcmVzdGF1cmFudHM7XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHRzdGF0aWMgdG9nZ2xlRmF2b3JpdGVSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuXHRcdHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudC5pZH0vP2lzX2Zhdm9yaXRlPSR7cmVzdGF1cmFudC5pc19mYXZvcml0ZX1gLCB7XHJcblx0XHRcdFx0bWV0aG9kOiBgUFVUYFxyXG5cdFx0XHR9KVxyXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcblx0XHRcdC50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG5cdFx0XHRcdERCSGVscGVyLmFkZFJlc3RhdXJhbnRzVG9JbmRleERCKFtyZXN0YXVyYW50XSk7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3RhdXJhbnQ7XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHJcblxyXG5cdHN0YXRpYyBhZGRSZXN0YXVyYW50c1RvSW5kZXhEQihyZXN0YXVyYW50cykge1xyXG5cdFx0cmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XHJcblx0XHRcdGlmICghZGIpIHJldHVybjtcclxuXHJcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJlc3RhdXJhbnRzYCwgYHJlYWR3cml0ZWApO1xyXG5cdFx0XHRjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKGByZXN0YXVyYW50c2ApO1xyXG5cdFx0XHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4gc3RvcmUucHV0KHJlc3RhdXJhbnQpKTtcclxuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCBhbGwgcmV2aWV3cy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXZpZXdzKHJlc3RhdXJhbnQpIHtcclxuXHRcdHJldHVybiBEQkhlbHBlci5nZXRSZXZpZXdzRnJvbUxvY2FsKHJlc3RhdXJhbnQpLnRoZW4ocmV2aWV3cyA9PiB7XHJcblx0XHRcdGlmIChyZXZpZXdzICYmIHJldmlld3MubGVuZ3RoKSB7XHJcblx0XHRcdFx0REJIZWxwZXIuZ2V0UmV2aWV3c0Zyb21SZW1vdGUocmVzdGF1cmFudCk7XHJcblx0XHRcdFx0cmV0dXJuIHJldmlld3M7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIERCSGVscGVyLmdldFJldmlld3NGcm9tUmVtb3RlKHJlc3RhdXJhbnQpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblx0c3RhdGljIGdldFJldmlld3NGcm9tTG9jYWwocmVzdGF1cmFudCkge1xyXG5cdFx0cmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XHJcblx0XHRcdGlmICghZGIpIHJldHVybjtcclxuXHJcblx0XHRcdHJldHVybiBkYi50cmFuc2FjdGlvbihgcmV2aWV3c2ApLm9iamVjdFN0b3JlKGByZXZpZXdzYCkuaW5kZXgoYGJ5LXJlc3RhdXJhbnRgKS5nZXRBbGwocmVzdGF1cmFudCk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRSZXZpZXdzRnJvbVJlbW90ZShyZXN0YXVyYW50KSB7XHJcblx0XHRyZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7cmVzdGF1cmFudH1gKVxyXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcblx0XHRcdC50aGVuKHJldmlld3MgPT4ge1xyXG5cdFx0XHRcdERCSGVscGVyLmFkZFJldmlld3NUb0luZGV4REIocmV2aWV3cyk7XHJcblx0XHRcdFx0cmV0dXJuIHJldmlld3M7XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHRzdGF0aWMgYWRkTmV3UmV2aWV3KHJldmlldykge1xyXG5cdFx0cmV0dXJuIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmV2aWV3c2AsIHtcclxuXHRcdFx0XHRtZXRob2Q6IGBQT1NUYCxcclxuXHRcdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpXHJcblx0XHRcdH0pXHJcblx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuXHRcdFx0LnRoZW4ocmV2aWV3ID0+IHtcclxuXHRcdFx0XHREQkhlbHBlci5hZGRSZXZpZXdzVG9JbmRleERCKFtyZXZpZXddKTtcclxuXHRcdFx0XHRyZXR1cm4gcmV2aWV3O1xyXG5cdFx0XHR9KTtcclxuXHR9XHJcblx0c3RhdGljIGFkZFJldmlld3NUb0luZGV4REIocmV2aWV3cykge1xyXG5cdFx0cmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XHJcblx0XHRcdGlmICghZGIpIHJldHVybjtcclxuXHJcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJldmlld3NgLCBgcmVhZHdyaXRlYCk7XHJcblx0XHRcdGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3NgKTtcclxuXHRcdFx0cmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiBzdG9yZS5wdXQocmV2aWV3KSk7XHJcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xyXG5cdFx0cmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XHJcblx0XHRcdGlmICghZGIpIHJldHVybjtcclxuXHRcdFx0Ly9wYXJzZUludCBiZWNhdXNlIGlkIGFyZSBzdG9yZWQgYXMgaW50ZWdlcnMgb24gZGF0YWJhc2VcclxuXHRcdFx0cmV0dXJuIGRiLnRyYW5zYWN0aW9uKGByZXN0YXVyYW50c2ApLm9iamVjdFN0b3JlKGByZXN0YXVyYW50c2ApLmdldChwYXJzZUludChpZCkpO1xyXG5cdFx0fSkudGhlbihyZXN0YXVyYW50ID0+IHtcclxuXHRcdFx0cmV0dXJuIHJlc3RhdXJhbnQgfHwgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50cy8ke2lkfWApXHJcblx0XHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHQvKnN0YXRpYyBkZWxldGVSZXN0YXVyYW50c0Zyb21JbmRleERCKCkge1xyXG5cdFx0cmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XHJcblx0XHRcdGlmICghZGIpIHJldHVybjtcclxuXHJcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJlc3RhdXJhbnRzYCwgYHJlYWR3cml0ZWApO1xyXG5cdFx0XHRjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKGByZXN0YXVyYW50c2ApO1xyXG5cdFx0XHRzdG9yZS5vcGVuQ3Vyc29yKG51bGwsIGBwcmV2YClcclxuXHRcdFx0XHQudGhlbihmdW5jdGlvbihjdXJzb3IpIHtcclxuXHRcdFx0XHRcdHJldHVybiBjdXJzb3IuYWR2YW5jZSgzMCk7XHJcblx0XHRcdFx0fSlcclxuXHRcdFx0XHQudGhlbihmdW5jdGlvbiBkZWxldGVSZXN0KGN1cnNvcikge1xyXG5cdFx0XHRcdFx0aWYgKCFjdXJzb3IpIHJldHVybjtcclxuXHRcdFx0XHRcdGN1cnNvci5kZWxldGUoKTtcclxuXHRcdFx0XHRcdHJldHVybiBjdXJzb3IuY29udGludWUoKS50aGVuKGRlbGV0ZVJlc3QpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRyZXR1cm4gdHguY29tcGxldGU7XHJcblx0XHR9KTtcclxuXHR9Ki9cclxuXHQvKipcclxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUpIHtcclxuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuXHRcdHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKClcclxuXHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuXHRcdFx0LnRoZW4ocmVzdGF1cmFudHMgPT4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSkpXHJcblx0XHRcdC5jYXRjaCgoKSA9PiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKChkYikgPT4ge1xyXG5cdFx0XHRcdGlmICghZGIpIHJldHVybjtcclxuXHJcblx0XHRcdFx0cmV0dXJuIGRiLnRyYW5zYWN0aW9uKGByZXN0YXVyYW50c2ApLm9iamVjdFN0b3JlKGByZXN0YXVyYW50c2ApLmluZGV4KGBieS1jdWlzaW5lYCkuZ2V0QWxsKGN1aXNpbmUpO1xyXG5cdFx0XHR9KSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XHJcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuXHRcdHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKClcclxuXHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuXHRcdFx0LnRoZW4ocmVzdGF1cmFudHMgPT4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKSlcclxuXHRcdFx0LmNhdGNoKCgpID0+IERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XHJcblx0XHRcdFx0aWYgKCFkYikgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHRyZXR1cm4gZGIudHJhbnNhY3Rpb24oYHJlc3RhdXJhbnRzYCkub2JqZWN0U3RvcmUoYHJlc3RhdXJhbnRzYCkuaW5kZXgoYGJ5LW5laWdoYm9yaG9vZGApO1xyXG5cdFx0XHR9KSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XHJcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuXHRcdHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcclxuXHRcdFx0bGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuXHRcdFx0aWYgKGN1aXNpbmUgIT0gYGFsbGApIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuXHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAobmVpZ2hib3Job29kICE9IGBhbGxgKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuXHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXN1bHRzO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKCkge1xyXG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcblx0XHRyZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0XHRjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xyXG5cdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuXHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcblx0XHRcdHJldHVybiB1bmlxdWVOZWlnaGJvcmhvb2RzO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcblx0ICovXHJcblx0c3RhdGljIGZldGNoQ3Vpc2luZXMoKSB7XHJcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuXHRcdHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcclxuXHRcdFx0Ly8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0XHRjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG5cdFx0XHRjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcclxuXHRcdFx0cmV0dXJuIHVuaXF1ZUN1aXNpbmVzO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuXHRcdHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG5cdFx0cmV0dXJuIChgL2Fzc2V0cy9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcblx0ICovXHJcblx0c3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuXHRcdFx0cG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG5cdFx0XHR0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG5cdFx0XHR1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcblx0XHRcdG1hcDogbWFwLFxyXG5cdFx0XHRhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBtYXJrZXI7XHJcblx0fVxyXG5cclxufSJdfQ==
