"use strict";var map,restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];function fetchNeighborhoods(){DBHelper.fetchNeighborhoods().then(function(e){self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(function(e){return console.error(e)})}function fillNeighborhoodsHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})}function fetchCuisines(){DBHelper.fetchCuisines().then(function(e){self.cuisines=e,fillCuisinesHTML()}).catch(function(e){return console.error(e)})}function fillCuisinesHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})}function updateRestaurants(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,s=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,s).then(function(e){resetRestaurants(e),fillRestaurantsHTML()}).catch(function(e){return console.error(e)})}function resetRestaurants(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e}function fillRestaurantsHTML(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,n=document.getElementById("restaurants-list"),a=[];e.forEach(function(t){a.push(getRestaurantRating(t).then(function(e){t.rating=e,n.append(createRestaurantHTML(t))}))}),Promise.all(a).then(function(){addMarkersToMap(),enableLazyLoading()})}function createRestaurantHTML(e){var t="true"==e.is_favorite?'<span title="Favorite" style="position:absolute;color:yellow;font-size:30px;">‚≠ê </span>':"",n=DBHelper.imageUrlForRestaurant(e).replace(/\.[^/.]+$/,""),a="jpg",r=document.createElement("li");return r.innerHTML='\n\t<a href="'+DBHelper.urlForRestaurant(e)+'" aria-label="'+e.name+'">\n\t\t<figure>'+t+'\n\t\t\t<picture>\n\t\t\t\t<source class="lazy"  media="(max-width: 600px)"  data-srcset="'+n+"-400."+a+" 400w, "+n+"-800."+a+' 800w"\n\t\t\t\t\t\tsizes="100vw"></source>\n\t\t\t\t<source class="lazy"  media="(max-width: 960px)"  data-srcset="'+n+"-400."+a+" 400w, "+n+"-800."+a+' 800w"\n\t\t\t\t\t\tsizes="50vw"></source>\n\t\t\t\t<source class="lazy"  media="(min-width: 960px)"  data-srcset="'+n+"-400."+a+" 400w, "+n+"-800."+a+' 800w"\n\t\t\t\t\t\tsizes="360px"></source>\n\t\t\t\t<img class="lazy" src="placeholder-image.jpg" data-src="'+n+"-800."+a+'" alt="'+e.name+"'s restaurant photo\">\n\t\t\t</picture>\n\t\t\t<figcaption>\n\t\t\t\t<h1>"+e.name+' <span class="pull-right rating"><i class="material-icons" aria-label="Average rating">favorite</i>'+e.rating+'</span></h1>\n\t\t\t\t<p>\n\t\t\t\t\t<span><i class="material-icons" aria-label="Cuisine Type">restaurant_menu</i>'+e.cuisine_type+'</span>\n\t\t\t\t\t<span class="pull-right"><i class="material-icons" aria-label="Neighborhood">location_on</i>'+e.neighborhood+"</span>\n\t\t\t\t</p>\n\t\t\t</figcaption>\n\t\t</figure>\n\t</a>",r}function getRestaurantRating(e){return DBHelper.fetchReviews(e.id).then(function(e){var t=10*e.reduce(function(e,t){return e+t.rating},0);return Math.round(t/e.length,1)/10})}function addMarkersToMap(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants;self.map&&e&&e.forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})}function enableLazyLoading(){var e=[].slice.call(document.querySelectorAll(".lazy"));if("IntersectionObserver"in window){var n=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),n.unobserve(t)}})});e.forEach(function(e){return n.observe(e)})}}document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines(),updateRestaurants()}),window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501}}),addMarkersToMap(),google.maps.event.addListener(self.map,"tilesloaded",function(e){[].slice.call(document.querySelectorAll("img:not([alt])")).forEach(function(e){e.alt||(e.alt="")})})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRzX2luZGV4LmpzIl0sIm5hbWVzIjpbIm5laWdoYm9yaG9vZHMiLCJyZXN0YXVyYW50cyIsImN1aXNpbmVzIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiREJIZWxwZXIiLCJ0aGVuIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JFYWNoIiwibmVpZ2hib3Job29kIiwib3B0aW9uIiwidmFsdWUiLCJmZXRjaEN1aXNpbmVzIiwiZmlsbEN1aXNpbmVzSFRNTCIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwiY3Vpc2luZSIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJub0FsdEltYWdlcyIsImNTZWxlY3QiLCJpbWciLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibWFya2VycyIsIm0iLCJzZXRNYXAiLCJ1bCIsInJlc3RhdXJhbnQiLCJwcm9taXNlcyIsInB1c2giLCJnZXRSZXN0YXVyYW50UmF0aW5nIiwicmF0aW5nIiwiUHJvbWlzZSIsImFsbCIsImFkZE1hcmtlcnNUb01hcCIsImVuYWJsZUxhenlMb2FkaW5nIiwiYXBwZW5kIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJpbWFnZUZpbGVOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwicmVwbGFjZSIsInVybEZvclJlc3RhdXJhbnQiLCJuYW1lIiwiaXNfZmF2b3JpdGUiLCJpbWFnZUZpbGVFeHRlbnNpb24iLCJjdWlzaW5lX3R5cGUiLCJmZXRjaFJldmlld3MiLCJpZCIsInJldmlld3MiLCJzdW0iLCJyZWR1Y2UiLCJ0b3RhbCIsInJldmlldyIsIk1hdGgiLCJyb3VuZCIsIm1hcCIsIm1hcmtlciIsIndpbmRvdyIsImxvY2F0aW9uIiwiZ29vZ2xlIiwibWFwcyIsImV2ZW50IiwiYWRkTGlzdGVuZXIiLCJocmVmIiwidXJsIiwibGF6eUltYWdlcyIsImxhenlJbWFnZU9ic2VydmVyIiwiY2FsbCIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiZW50cmllcyIsImlzSW50ZXJzZWN0aW5nIiwib2JzZXJ2ZXIiLCJsYXp5SW1hZ2UiLCJlbnRyeSIsImNsYXNzTGlzdCIsImRhdGFzZXQiLCJzcmMiLCJ1bm9ic2VydmUiLCJzcmNzZXQiLCJyZW1vdmUiLCJvYnNlcnZlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsbmciLCJsYXQiLCJldnQiLCJzbGljZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhbHQiXSwibWFwcGluZ3MiOiJhQUFBLElBQ0NBLElBREdDLGlCQUFBQSxFQUNIRCxtQkFBQUEsRUFEREUsY0FBQUEsRUFFQ0EsUUFBQUEsR0FpQkQsU0FBU0MscUJBQVRDLFNBQVNELHFCQUFxQkUsS0FBQSxTQUFBTCxHQUM3QkksS0FBQUEsY0FBU0QsRUFDUkcsMEJBQ0FDLE1BQUFBLFNBQUFBLEdBQUFBLE9BQUFBLFFBQUFBLE1BQUFBLEtBSUYsU0FBQUEsd0JBQUEsSUFBQVAsRUFBQSxFQUFBUSxVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBQUYsS0FBQU4sY0FJT1csRUFBU0MsU0FBU0MsZUFBVCx3QkFDZmIsRUFBY2MsUUFBUSxTQUFBQyxHQUZ2QixJQUFBQyxFQUFTVCxTQUFBQSxjQUFBQSxVQUEwRFMsRUFBcENoQixVQUFvQ2UsRUFLakVDLEVBQU9DLE1BQVFGLEVBSmhCSixFQUFNQSxPQUFTQyxLQU9mLFNBQUFNLGdCQU1BZCxTQUFTYyxnQkFBZ0JiLEtBQUssU0FBQ0gsR0FKaENJLEtBQUFKLFNBQUFBLEVBTUVpQixxQkFDRUMsTUFBTSxTQUFDQyxHQUFELE9BQVdDLFFBQVFELE1BQU1BLEtBQXpCLFNBQVdDLG1CQUFYLElBQXlCRCxFQUF6QixFQUFBYixVQUFBQyxhQUFB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QUE2RCxLQUNBSSxPQUZEQyxLQUFBQyxNQUFBQyxZQUFBTixFQUVDLFFBRkQsV0FHQTlELE9BQUs2QixTQUFMd0MsS0FBQVAsRUFBQVEsTUFFRHRFLEtBQUE2QixRQUFBTSxLQUFBMkIsS0FNQSxTQUFJckIsb0JBQ0gsSUFBQThCLEVBQUlDLEdBQUFBLE1BQW9CQyxLQUFJQyxTQUFBQSxpQkFBQUEsVUFDM0JDLEdBQUFBLHlCQUFnQlosT0FBUyxDQUN4QixJQUFBUyxFQUFVSSxJQUFnQkYscUJBQUEsU0FBQUMsRUFBQUUsR0FDekJGLEVBQUlHLFFBQUFBLFNBQUFBLEdBQ0pBLEdBQUFBLEVBQUFBLGVBQWdCQSxDQUNoQkEsSUFBQUEsRUFBQUMsRUFBbUJELE9BQ25CQSxFQUFVRSxJQUFBQSxFQUFWQyxRQUFBQyxJQUNBVixFQUFBQSxPQUFrQlcsRUFBVUwsUUFBNUJNLE9BQ0FOLEVBQUFFLFVBQUFLLE9BQUEsUUFQRmIsRUFBQVcsVUFBQUwsUUFVa0JQLEVBQW5CL0QsUUFBQSxTQUFBc0UsR0FBQSxPQUFBTixFQUFBYyxRQUFBUixNQTdNRnhFLFNBQVNpRixpQkFBVCxtQkFBOEMsU0FBQ3BCLEdBQzlDdEUscUJBRERTLGdCQUNDVCxzQkErQ0NhLE9BQUFBLFFBQU9TLFdBY1JuQixLQUFLNkQsSUFBTSxJQUFJSSxPQUFPQyxLQUFLc0IsSUFBSWxGLFNBQVNDLGVBQVQsT0FBZ0MsQ0FSaEVrRixLQUFBLEdBVUVDLE9BZk8vRSxDQUNQTixJQUFBQSxVQUpEc0YsS0FBQSxhQVdENUIsa0JBRUU2QixPQUFLMUIsS0FBQUMsTUFESUMsWUFBQXBFLEtBQUE2RCxJQUNUK0IsY0FEUyxTQUFBQyxHQUVILEdBQUFDLE1BQUFyQixLQUFBbkUsU0FBQXlGLGlCQUFBLG1CQUZQdkYsUUFBQSxTQUFBYyxHQUlLdUMsRUFBTW1DLE1BQUkvQixFQUFBQSxJQUFBQSIsImZpbGUiOiJyZXN0YXVyYW50c19pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50cyxcclxuXHRuZWlnaGJvcmhvb2RzLFxyXG5cdGN1aXNpbmVzO1xyXG52YXIgbWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihgRE9NQ29udGVudExvYWRlZGAsIChldmVudCkgPT4ge1xyXG5cdGZldGNoTmVpZ2hib3Job29kcygpO1xyXG5cdGZldGNoQ3Vpc2luZXMoKTtcclxuXHR1cGRhdGVSZXN0YXVyYW50cygpO1xyXG5cclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZnVuY3Rpb24gZmV0Y2hOZWlnaGJvcmhvb2RzKCkge1xyXG5cdERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygpLnRoZW4oKG5laWdoYm9yaG9vZHMpID0+IHtcclxuXHRcdHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcblx0XHRmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuXHR9KS5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsTmVpZ2hib3Job29kc0hUTUwobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykge1xyXG5cdGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBuZWlnaGJvcmhvb2RzLXNlbGVjdGApO1xyXG5cdG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgb3B0aW9uYCk7XHJcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG5cdFx0b3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG5cdFx0c2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG5cdH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZldGNoQ3Vpc2luZXMoKSB7XHJcblx0REJIZWxwZXIuZmV0Y2hDdWlzaW5lcygpLnRoZW4oKGN1aXNpbmVzKSA9PiB7XHJcblx0XHRzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcblx0XHRmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcblx0fSkuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxDdWlzaW5lc0hUTUwoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSB7XHJcblx0Y29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGN1aXNpbmVzLXNlbGVjdGApO1xyXG5cclxuXHRjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgb3B0aW9uYCk7XHJcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuXHRcdG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcblx0fSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuXHRsZXQgbG9jID0ge1xyXG5cdFx0bGF0OiA0MC43MjIyMTYsXHJcblx0XHRsbmc6IC03My45ODc1MDFcclxuXHR9O1xyXG5cdHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbWFwYCksIHtcclxuXHRcdHpvb206IDEyLFxyXG5cdFx0Y2VudGVyOiBsb2MsXHJcblx0fSk7XHJcblx0YWRkTWFya2Vyc1RvTWFwKCk7XHJcblx0LyogU2V0IGFsdCBhdHRyaWJ1dGVzIG9uIG1hcHMgaW1hZ2VzIHNvIHRoZXkgZG9udCBnZXQgcmVhZGVkIGJ5IHNjcmVlblJlYWRlcnMgKi9cclxuXHRnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihzZWxmLm1hcCwgYHRpbGVzbG9hZGVkYCwgZnVuY3Rpb24oZXZ0KSB7XHJcblx0XHR2YXIgbm9BbHRJbWFnZXMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGltZzpub3QoW2FsdF0pYCkpO1xyXG5cdFx0bm9BbHRJbWFnZXMuZm9yRWFjaChpbWcgPT4ge1xyXG5cdFx0XHRpZiAoIWltZy5hbHQpIGltZy5hbHQgPSBgYDtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG5mdW5jdGlvbiB1cGRhdGVSZXN0YXVyYW50cygpIHtcclxuXHRjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGN1aXNpbmVzLXNlbGVjdGApO1xyXG5cdGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbmVpZ2hib3Job29kcy1zZWxlY3RgKTtcclxuXHJcblx0Y29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cdGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcblx0Y29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuXHRjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG5cdERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRyZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuXHRcdGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuXHR9KS5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5mdW5jdGlvbiByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKSB7XHJcblx0Ly8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG5cdHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuXHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXN0YXVyYW50cy1saXN0YCk7XHJcblx0dWwuaW5uZXJIVE1MID0gYGA7XHJcblxyXG5cdC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuXHRzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuXHRzZWxmLm1hcmtlcnMgPSBbXTtcclxuXHRzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRzSFRNTChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpIHtcclxuXHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXN0YXVyYW50cy1saXN0YCk7XHJcblx0bGV0IHByb21pc2VzID0gW107XHJcblx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuXHRcdHByb21pc2VzLnB1c2goZ2V0UmVzdGF1cmFudFJhdGluZyhyZXN0YXVyYW50KS50aGVuKHJhdGluZyA9PiB7XHJcblx0XHRcdHJlc3RhdXJhbnQucmF0aW5nID0gcmF0aW5nO1xyXG5cdFx0XHR1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG5cdFx0fSkpO1xyXG5cdFx0Ly91bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG5cdH0pO1xyXG5cdFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKCgpID0+IHtcclxuXHRcdGFkZE1hcmtlcnNUb01hcCgpO1xyXG5cdFx0ZW5hYmxlTGF6eUxvYWRpbmcoKTtcclxuXHR9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSB7XHJcblx0Y29uc3QgaXNfZmF2b3JpdGUgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09IGB0cnVlYCA/IGA8c3BhbiB0aXRsZT1cIkZhdm9yaXRlXCIgc3R5bGU9XCJwb3NpdGlvbjphYnNvbHV0ZTtjb2xvcjp5ZWxsb3c7Zm9udC1zaXplOjMwcHg7XCI+4q2QIDwvc3Bhbj5gIDogYGA7XHJcblx0Ly9yZXN0YXVyYW50LnJhdGluZyA9IGdldFJlc3RhdXJhbnRSYXRpbmcocmVzdGF1cmFudCk7XHJcblx0Y29uc3QgaW1hZ2VGaWxlTmFtZSA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KS5yZXBsYWNlKC9cXC5bXi8uXSskLywgYGApO1xyXG5cdC8qY29uc3QgaW1hZ2VGaWxlRXh0ZW5zaW9uID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLnNwbGl0KGAuYCkucG9wKCk7Ki9cclxuXHRjb25zdCBpbWFnZUZpbGVFeHRlbnNpb24gPSBganBnYDtcclxuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGxpYCk7XHJcblx0bGkuaW5uZXJIVE1MID0gYFxyXG5cdDxhIGhyZWY9XCIke0RCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9XCIgYXJpYS1sYWJlbD1cIiR7cmVzdGF1cmFudC5uYW1lfVwiPlxyXG5cdFx0PGZpZ3VyZT4ke2lzX2Zhdm9yaXRlfVxyXG5cdFx0XHQ8cGljdHVyZT5cclxuXHRcdFx0XHQ8c291cmNlIGNsYXNzPVwibGF6eVwiICBtZWRpYT1cIihtYXgtd2lkdGg6IDYwMHB4KVwiICBkYXRhLXNyY3NldD1cIiR7aW1hZ2VGaWxlTmFtZX0tNDAwLiR7aW1hZ2VGaWxlRXh0ZW5zaW9ufSA0MDB3LCAke2ltYWdlRmlsZU5hbWV9LTgwMC4ke2ltYWdlRmlsZUV4dGVuc2lvbn0gODAwd1wiXHJcblx0XHRcdFx0XHRcdHNpemVzPVwiMTAwdndcIj48L3NvdXJjZT5cclxuXHRcdFx0XHQ8c291cmNlIGNsYXNzPVwibGF6eVwiICBtZWRpYT1cIihtYXgtd2lkdGg6IDk2MHB4KVwiICBkYXRhLXNyY3NldD1cIiR7aW1hZ2VGaWxlTmFtZX0tNDAwLiR7aW1hZ2VGaWxlRXh0ZW5zaW9ufSA0MDB3LCAke2ltYWdlRmlsZU5hbWV9LTgwMC4ke2ltYWdlRmlsZUV4dGVuc2lvbn0gODAwd1wiXHJcblx0XHRcdFx0XHRcdHNpemVzPVwiNTB2d1wiPjwvc291cmNlPlxyXG5cdFx0XHRcdDxzb3VyY2UgY2xhc3M9XCJsYXp5XCIgIG1lZGlhPVwiKG1pbi13aWR0aDogOTYwcHgpXCIgIGRhdGEtc3Jjc2V0PVwiJHtpbWFnZUZpbGVOYW1lfS00MDAuJHtpbWFnZUZpbGVFeHRlbnNpb259IDQwMHcsICR7aW1hZ2VGaWxlTmFtZX0tODAwLiR7aW1hZ2VGaWxlRXh0ZW5zaW9ufSA4MDB3XCJcclxuXHRcdFx0XHRcdFx0c2l6ZXM9XCIzNjBweFwiPjwvc291cmNlPlxyXG5cdFx0XHRcdDxpbWcgY2xhc3M9XCJsYXp5XCIgc3JjPVwicGxhY2Vob2xkZXItaW1hZ2UuanBnXCIgZGF0YS1zcmM9XCIke2ltYWdlRmlsZU5hbWV9LTgwMC4ke2ltYWdlRmlsZUV4dGVuc2lvbn1cIiBhbHQ9XCIke3Jlc3RhdXJhbnQubmFtZX0ncyByZXN0YXVyYW50IHBob3RvXCI+XHJcblx0XHRcdDwvcGljdHVyZT5cclxuXHRcdFx0PGZpZ2NhcHRpb24+XHJcblx0XHRcdFx0PGgxPiR7cmVzdGF1cmFudC5uYW1lfSA8c3BhbiBjbGFzcz1cInB1bGwtcmlnaHQgcmF0aW5nXCI+PGkgY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiIGFyaWEtbGFiZWw9XCJBdmVyYWdlIHJhdGluZ1wiPmZhdm9yaXRlPC9pPiR7cmVzdGF1cmFudC5yYXRpbmd9PC9zcGFuPjwvaDE+XHJcblx0XHRcdFx0PHA+XHJcblx0XHRcdFx0XHQ8c3Bhbj48aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCIgYXJpYS1sYWJlbD1cIkN1aXNpbmUgVHlwZVwiPnJlc3RhdXJhbnRfbWVudTwvaT4ke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfTwvc3Bhbj5cclxuXHRcdFx0XHRcdDxzcGFuIGNsYXNzPVwicHVsbC1yaWdodFwiPjxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIiBhcmlhLWxhYmVsPVwiTmVpZ2hib3Job29kXCI+bG9jYXRpb25fb248L2k+JHtyZXN0YXVyYW50Lm5laWdoYm9yaG9vZH08L3NwYW4+XHJcblx0XHRcdFx0PC9wPlxyXG5cdFx0XHQ8L2ZpZ2NhcHRpb24+XHJcblx0XHQ8L2ZpZ3VyZT5cclxuXHQ8L2E+YDtcclxuXHJcblx0cmV0dXJuIGxpO1xyXG59XHJcbi8qXHJcbiAqIEdldCByYXRpbmcgYXZlcmFnZSBmb3IgcmVzdGF1cmFudCBmcm9tIGl0cyByZXZpZXdzXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRSZXN0YXVyYW50UmF0aW5nKHJlc3RhdXJhbnQpIHtcclxuXHRyZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXZpZXdzKHJlc3RhdXJhbnQuaWQpLnRoZW4ocmV2aWV3cyA9PiB7XHJcblx0XHR2YXIgc3VtID0gcmV2aWV3cy5yZWR1Y2UoKHRvdGFsLCByZXZpZXcpID0+IHRvdGFsICsgcmV2aWV3LnJhdGluZywgMCkgKiAxMDtcclxuXHRcdHJldHVybiBNYXRoLnJvdW5kKHN1bSAvIHJldmlld3MubGVuZ3RoLCAxKSAvIDEwO1xyXG5cdH0pO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmZ1bmN0aW9uIGFkZE1hcmtlcnNUb01hcChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpIHtcclxuXHRpZiAoIXNlbGYubWFwIHx8ICFyZXN0YXVyYW50cykgcmV0dXJuO1xyXG5cdHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcblx0XHQvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuXHRcdGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCBgY2xpY2tgLCAoKSA9PiB7XHJcblx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcclxuXHRcdH0pO1xyXG5cdFx0c2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuXHR9KTtcclxufVxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmZ1bmN0aW9uIGVuYWJsZUxhenlMb2FkaW5nKCkge1xyXG5cdHZhciBsYXp5SW1hZ2VzID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAubGF6eWApKTtcclxuXHRpZiAoYEludGVyc2VjdGlvbk9ic2VydmVyYCBpbiB3aW5kb3cpIHtcclxuXHRcdGxldCBsYXp5SW1hZ2VPYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcigoZW50cmllcywgb2JzZXJ2ZXIpID0+IHtcclxuXHRcdFx0ZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcclxuXHRcdFx0XHRpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcclxuXHRcdFx0XHRcdGxldCBsYXp5SW1hZ2UgPSBlbnRyeS50YXJnZXQ7XHJcblx0XHRcdFx0XHRsYXp5SW1hZ2Uuc3JjID0gbGF6eUltYWdlLmRhdGFzZXQuc3JjO1xyXG5cdFx0XHRcdFx0bGF6eUltYWdlLnNyY3NldCA9IGxhenlJbWFnZS5kYXRhc2V0LnNyY3NldDtcclxuXHRcdFx0XHRcdGxhenlJbWFnZS5jbGFzc0xpc3QucmVtb3ZlKGBsYXp5YCk7XHJcblx0XHRcdFx0XHRsYXp5SW1hZ2VPYnNlcnZlci51bm9ic2VydmUobGF6eUltYWdlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fSk7XHJcblx0XHRsYXp5SW1hZ2VzLmZvckVhY2gobGF6eUltYWdlID0+IGxhenlJbWFnZU9ic2VydmVyLm9ic2VydmUobGF6eUltYWdlKSk7XHJcblx0fSBlbHNlIHtcclxuXHRcdC8vIFBvc3NpYmx5IGZhbGwgYmFjayB0byBhIG1vcmUgY29tcGF0aWJsZSBtZXRob2QgaGVyZVxyXG5cdH1cclxufSJdfQ==
